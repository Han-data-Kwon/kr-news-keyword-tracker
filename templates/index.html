<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>êµ­ë‚´ ë‰´ìŠ¤ & ê¸°ì—… ì •ë³´ í‚¤ì›Œë“œ ê²€ìƒ‰ê¸°</title>

  <!-- âœ… Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding: 2rem;
      background-color: #f8f9fa;
    }
    h2 {
      margin-bottom: 2rem;
    }
    .section {
      margin-top: 1rem;
    }
    table {
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <h2>êµ­ë‚´ ë‰´ìŠ¤ & ê¸°ì—… ì •ë³´ í‚¤ì›Œë“œ ê²€ìƒ‰ê¸°</h2>

  <!-- âœ… íƒ­ ë²„íŠ¼ ì˜ì—­ -->
  <ul class="nav nav-tabs my-4" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="news-tab" data-bs-toggle="tab" data-bs-target="#news-section" type="button" role="tab" aria-controls="news-section" aria-selected="true">
        ë‰´ìŠ¤ ê²€ìƒ‰
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="company-tab" data-bs-toggle="tab" data-bs-target="#company-section" type="button" role="tab" aria-controls="company-section" aria-selected="false">
        ê¸°ì—… ì •ë³´ ê²€ìƒ‰
      </button>
    </li>
  </ul>

  <!-- âœ… íƒ­ ì½˜í…ì¸  ì˜ì—­ -->
  <div class="tab-content">
    <!-- ğŸ“Œ ë‰´ìŠ¤ ê²€ìƒ‰ íƒ­ -->
    <div class="tab-pane fade show active" id="news-section" role="tabpanel" aria-labelledby="news-tab">
      <div class="mb-3">
        <input type="text" id="keyword" class="form-control" placeholder="ì˜ˆ: ë³µì§€, B2B, íŠ¸ëŸ¼í”„" />
        <button class="btn btn-success mt-2" onclick="searchNews()">ê²€ìƒ‰</button>
      </div>
      <div id="news-container" class="mb-4"></div>
      <div id="trend-charts"></div>
    </div>

    <!-- ğŸ“Œ ì‚¬ì—…ìë“±ë¡ ìƒíƒœì¡°íšŒ íƒ­ -->
    <div class="tab-pane fade" id="company-section" role="tabpanel" aria-labelledby="company-tab">
      <h5>ğŸ“ ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì—‘ì…€ ì—…ë¡œë“œ</h5>
      <form id="ntsForm" enctype="multipart/form-data">
        <div class="input-group mb-3">
          <input type="file" name="file" accept=".xlsx" class="form-control" required>
          <button type="submit" class="btn btn-primary">ì¡°íšŒ</button>
        </div>
        <div class="form-text">â€» ì—‘ì…€ì— <strong>'ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸'</strong> ì»¬ëŸ¼ì´ í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</div>
      </form>
      <table class="table table-bordered mt-3" id="nts-result-table">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</th>
            <th>ìƒíƒœ</th>
            <th>ê³¼ì„¸ìœ í˜•</th>
            <th>íì—…ì¼ì</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- âœ… Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- âœ… JS ê¸°ëŠ¥ ì •ì˜ -->
  <script>
    function searchNews() {
      const keyword = document.getElementById("keyword").value.trim();
      if (!keyword) return alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

      fetch(`/api/search_news?q=${encodeURIComponent(keyword)}`)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("news-container");
          container.innerHTML = "";
          if (data.length === 0) {
            container.innerHTML = "<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }
          data.forEach((item, idx) => {
            const div = document.createElement("div");
            div.innerHTML = `
              <p><strong>${idx + 1}. <a href="${item.link}" target="_blank">${item.title}</a></strong></p>
              <small>${new Date(item.date).toLocaleString("ko-KR")}</small><hr>
            `;
            container.appendChild(div);
          });
        });
    }

    
  // âœ… ìˆ˜ì •ëœ JavaScript ì½”ë“œ ì „ì²´
  document.getElementById("ntsForm").addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch("/api/nts", {
      method: "POST",
      body: formData
    })
    .then(async (res) => {
      if (!res.ok) {
        const errData = await res.json().catch(() => ({ error: "ì„œë²„ ì˜¤ë¥˜ ë°œìƒ" }));
        alert("âŒ " + (errData.error || "ìš”ì²­ ì‹¤íŒ¨"));
        throw new Error("HTTP error " + res.status);
      }
      return res.json();
    })
    .then(data => {
      const tbody = document.querySelector("#nts-result-table tbody");
      tbody.innerHTML = "";

      if (data.error) {
        alert(data.error);
        return;
      }

      data.forEach((row, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${row["ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸"]}</td>
          <td>${row["ìƒíƒœ"]}</td>
          <td>${row["ê³¼ì„¸ìœ í˜•"]}</td>
          <td>${row["íì—…ì¼ì"] || "-"}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => {
      console.error("ğŸš¨ ìš”ì²­ ì‹¤íŒ¨:", err);
    });
  });
</script>
</body>
</html>
