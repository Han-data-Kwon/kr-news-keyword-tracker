<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>국내 뉴스 & 기업 정보 키워드 검색기</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .tabs { display: flex; margin-bottom: 10px; cursor: pointer; }
    .tab { margin-right: 10px; padding: 5px 10px; background: #eee; border-radius: 5px; }
    .tab.active { background: #333; color: #fff; }
    .tab-content { display: none; }
    .tab-content.active { display: block; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 5px; font-size: 14px; }
    input { padding: 5px; margin-right: 5px; }
    button { padding: 5px 10px; }
  </style>
</head>
<body>
  <h1>국내 뉴스 & 기업 정보 키워드 검색기</h1>

  <!-- 탭 메뉴 -->
  <ul class="tabs">
    <li class="tab active" onclick="showTab('news')">뉴스 검색</li>
    <li class="tab" onclick="showTab('trend')">검색 트렌드</li>
    <li class="tab" onclick="showTab('company')">기업 정보 검색</li>
  </ul>

  <!-- 뉴스 검색 탭 -->
  <div id="news" class="tab-content active">
    <h2>뉴스 검색</h2>
    <input type="text" id="newsKeyword" placeholder="검색어 입력">
    <button onclick="searchNews()">검색</button>
    <ul id="newsResults"></ul>
  </div>

  <!-- 트렌드 검색 탭 -->
  <div id="trend" class="tab-content">
    <h2>검색 트렌드</h2>
    <input type="text" id="trendKeyword" placeholder="검색어 입력">
    <select id="trendPeriod">
      <option value="30d">30일</option>
      <option value="1y">1년</option>
    </select>
    <button onclick="searchTrend()">조회</button>
    <table id="trendResults">
      <thead><tr><th>날짜</th><th>비율</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- 기업 정보 검색 탭 -->
  <div id="company" class="tab-content">
    <h2>기업 정보 검색</h2>
    <input type="text" id="companyKeyword" placeholder="기업명 입력">
    <button onclick="searchCompany()">검색</button>
    <table id="companyResults">
      <thead>
        <tr>
          <th>사업장명</th>
          <th>업종코드명</th>
          <th>등록일</th>
          <th>가입자수</th>
          <th>도로명주소</th>
          <th>삭제</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
    }

    function searchNews() {
      const keyword = document.getElementById("newsKeyword").value.trim();
      if (!keyword) return;

      fetch(`/api/search_news?q=${encodeURIComponent(keyword)}`)
        .then(res => res.json())
        .then(data => {
          const ul = document.getElementById("newsResults");
          ul.innerHTML = "";
          data.forEach(item => {
            const li = document.createElement("li");
            li.innerHTML = `<a href="${item.link}" target="_blank">${item.title}</a> (${item.date})`;
            ul.appendChild(li);
          });
        });
    }

    function searchTrend() {
      const keyword = document.getElementById("trendKeyword").value.trim();
      const period = document.getElementById("trendPeriod").value;
      if (!keyword) return;

      fetch(`/api/trend?q=${encodeURIComponent(keyword)}&period=${period}`)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#trendResults tbody");
          tbody.innerHTML = "";
          data.forEach(item => {
            const row = document.createElement("tr");
            row.innerHTML = `<td>${item.date}</td><td>${item.ratio}</td>`;
            tbody.appendChild(row);
          });
        });
    }

    function searchCompany() {
      const keyword = document.getElementById("companyKeyword").value.trim();
      if (!keyword) return;

      fetch(`/api/nps?keyword=${encodeURIComponent(keyword)}`)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector("#companyResults tbody");
          data.forEach(item => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${item["사업장명"]}</td>
              <td>${item["업종코드명"]}</td>
              <td>${item["등록일"]}</td>
              <td>${item["가입자수"]}</td>
              <td>${item["도로명주소"]}</td>
              <td><button onclick="this.closest('tr').remove()">삭제</button></td>
            `;
            tbody.appendChild(row);
          });
        })
        .catch(err => {
          console.error("기업 정보 검색 오류:", err);
          alert("검색에 실패했습니다.");
        });
    }
  </script>
</body>
</html>
